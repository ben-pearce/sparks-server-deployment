name: code
services:
  code-server:
    image: lscr.io/linuxserver/code-server:4.99.3@sha256:eebc06d825b45fc94ec5fc8ca4aae1887eec91232439abcd893b8a2b70242943
    container_name: code-server
    volumes:
      - ${CONFIG_DIR}/code:/config
      - ${HOME_DIR}/.gitconfig:/config/.gitconfig
      - ${HOME_DIR}/.gnupg:/config/.gnupg
      - ${HOME_DIR}/.ssh:/config/.ssh
      - /mnt/workspaces:/mnt/workspaces
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker
    environment:
      - PUID
      - PGID
      - TZ
      - DEFAULT_WORKSPACE=/mnt/workspaces
      - DOCKER_MODS=linuxserver/mods:code-server-python3
    restart: unless-stopped
    labels:
      readme.description: VS Code in the browser
      readme.links.github: https://github.com/coder/code-server
      traefik.enable: true
      traefik.http.routers.code-server.entrypoints: https
      traefik.http.routers.code-server.middlewares: authelia
      traefik.http.routers.code-server.rule: Host(`code.${HOST}`)
      traefik.http.routers.code-server.tls.certresolver: resolver
      traefik.http.services.code-server.loadbalancer.server.port: 8443
    privileged: true
